## TEST JOIN QUERY

SELECT sb.SB_EIN, sb.SB_PN, sb.SB_CURR_VALUE_AST_01_AMT, sb.SB_TOT_FNDNG_TGT_AMT, sb.SB_PLAN_YEAR_BEGIN_DATE, sb.SB_EFF_INT_RATE_PRCNT,
        form.SPONSOR_DFE_NAME, form.PLAN_NAME, form.SHORT_PLAN_YR_IND, form.COLLECTIVE_BARGAIN_IND,
        h.TOT_ASSETS_BOY_AMT, h.TOT_ASSETS_EOY_AMT, h.TOT_LIABILITIES_BOY_AMT, h.TOT_LIABILITIES_EOY_AMT, h.NET_ASSETS_BOY_AMT, h.NET_ASSETS_EOY_AMT
FROM sb_full sb
  LEFT JOIN f5500_full form
    ON sb.SB_EIN = form.SPONS_DFE_EIN AND sb.SB_PN = form.SPONS_DFE_PN
  LEFT JOIN h_full h
    ON sb.SB_EIN = h.SCH_H_EIN AND sb.SB_PN = h.SCH_H_PN
  WHERE sb.SB_PLAN_YEAR_BEGIN_DATE BETWEEN '2017-01-01' AND '2017-12-31';

## Pull plan sponsor name

SELECT f.SPONSOR_DFE_NAME, f.SPONS_DFE_DBA_NAME, f.SPONS_DFE_CARE_OF_NAME,

## Look at Form 5500 - how many have Sch SB attached by year

SELECT f.TYPE_PLAN_ENTITY_CD, f.SPONSOR_DFE_NAME, f.FORM_PLAN_YEAR_BEGIN_DATE, f.SPONS_DFE_DBA_NAME, f.SCH_SB_ATTACHED_IND
  FROM f5500_full f

## Preliminary Model Features -- all years

SELECT sb.SB_TOT_PARTCP_CNT, sb.SB_PLAN_AT_RISK_IND, sb.SB_EFF_INT_RATE_PRCNT, sb.SB_PLAN_YEAR_BEGIN_DATE, sb.SB_FNDNG_SHORT_IND, \
       sb.SB_PR_YR_FNDNG_PRCNT, sb.SB_FNDNG_TGT_PRCNT, sb.SB_TOT_FNDNG_TGT_AMT, sb.SB_CURR_VALUE_AST_01_AMT, \
       sb.SB_PLAN_TYPE_CODE \
FROM sb_full sb;

## Preliminary Model Features  -- 2017 only

SELECT sb.SB_TOT_PARTCP_CNT, sb.SB_PLAN_AT_RISK_IND, sb.SB_EFF_INT_RATE_PRCNT, sb.SB_PLAN_YEAR_BEGIN_DATE, sb.SB_FNDNG_SHORT_IND, \
       sb.SB_PR_YR_FNDNG_PRCNT, sb.SB_FNDNG_TGT_PRCNT, sb.SB_TOT_FNDNG_TGT_AMT, sb.SB_CURR_VALUE_AST_01_AMT, \
       sb.SB_PLAN_TYPE_CODE \
FROM sb_full sb
WHERE sb.SB_PLAN_YEAR_BEGIN_DATE BETWEEN '2017-01-01' AND '2017-12-31';

## Preliminary Model Features -- 2017 only, add Form 5500 business code
SELECT sb.SB_TOT_PARTCP_CNT, sb.SB_PLAN_AT_RISK_IND, sb.SB_EFF_INT_RATE_PRCNT, sb.SB_PLAN_YEAR_BEGIN_DATE, sb.SB_FNDNG_SHORT_IND, \
       sb.SB_PR_YR_FNDNG_PRCNT, sb.SB_FNDNG_TGT_PRCNT, sb.SB_TOT_FNDNG_TGT_AMT, sb.SB_CURR_VALUE_AST_01_AMT, \
       sb.SB_PLAN_TYPE_CODE, f.BUSINESS_CODE \
FROM sb_full sb \
LEFT JOIN f5500_full f \
ON sb.SB_EIN = f.SPONS_DFE_EIN AND sb.SB_PN = f.SPONS_DFE_PN \
WHERE sb.SB_PLAN_YEAR_BEGIN_DATE BETWEEN '2017-01-01' AND '2017-12-31';"
